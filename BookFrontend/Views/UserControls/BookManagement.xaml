<UserControl x:Class="book_frontend.Views.UserControls.BookManagement"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:viewModels="clr-namespace:book_frontend.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance Type=viewModels:BookManagementViewModel, IsDesignTimeCreatable=False}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <!-- 搜索条件区域 -->
            <RowDefinition Height="Auto" />
            <!-- 操作按钮区域 -->
            <RowDefinition Height="Auto" />
            <!-- 数据展示区域 -->
            <RowDefinition Height="*" />
            <!-- 分页区域 -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 搜索条件区域 -->
        <Border Grid.Row="0" Background="White" BorderBrush="#e0e0e0" BorderThickness="1"
                CornerRadius="5" Padding="20" Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 第一行搜索条件 (4个字段) -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="图书标题" FontWeight="Bold" Margin="0,0,0,5" />
                    <TextBox Text="{Binding SearchTitle, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="请输入图书标题"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                        </TextBox.InputBindings>
                    </TextBox>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,10,0">
                    <TextBlock Text="作者" FontWeight="Bold" Margin="0,0,0,5" />
                    <TextBox Text="{Binding SearchAuthor, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="请输入作者姓名"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                        </TextBox.InputBindings>
                    </TextBox>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,10,0">
                    <TextBlock Text="ISBN" FontWeight="Bold" Margin="0,0,0,5" />
                    <TextBox Text="{Binding SearchIsbn, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="请输入ISBN"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                        </TextBox.InputBindings>
                    </TextBox>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="3" Margin="0,0,10,0">
                    <TextBlock Text="出版社" FontWeight="Bold" Margin="0,0,0,5" />
                    <TextBox Text="{Binding SearchPublisher, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="请输入出版社"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                        </TextBox.InputBindings>
                    </TextBox>
                </StackPanel>

                <!-- 搜索按钮 -->
                <StackPanel Grid.Row="0" Grid.Column="4" VerticalAlignment="Bottom">
                    <Button Command="{Binding SearchCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#2196F3"
                            Foreground="White"
                            Padding="20,8"
                            Margin="10,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Magnify" Width="16" Height="16"
                                                     VerticalAlignment="Center" Margin="0,0,5,0" />
                            <TextBlock Text="搜索" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- 第二行搜索条件 (3个字段) -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,15,10,0">
                    <TextBlock Text="分类" FontWeight="Bold" Margin="0,0,0,5" />
                    <TextBox Text="{Binding SearchCategory, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="请输入分类"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                        </TextBox.InputBindings>
                    </TextBox>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,15,10,0">
                    <TextBlock Text="出版日期开始" FontWeight="Bold" Margin="0,0,0,5" />
                    <DatePicker SelectedDate="{Binding SearchPublishDateStart, UpdateSourceTrigger=PropertyChanged}"
                                materialDesign:HintAssist.Hint="请选择开始日期"
                                Style="{StaticResource MaterialDesignOutlinedDatePicker}" />
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,15,10,0">
                    <TextBlock Text="出版日期结束" FontWeight="Bold" Margin="0,0,0,5" />
                    <DatePicker SelectedDate="{Binding SearchPublishDateEnd, UpdateSourceTrigger=PropertyChanged}"
                                materialDesign:HintAssist.Hint="请选择结束日期"
                                Style="{StaticResource MaterialDesignOutlinedDatePicker}" />
                </StackPanel>

                <!-- 重置按钮 -->
                <StackPanel Grid.Row="1" Grid.Column="4" VerticalAlignment="Bottom">
                    <Button Command="{Binding ResetCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            BorderBrush="#666"
                            Foreground="#666"
                            Padding="20,8"
                            Margin="10,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16"
                                                     VerticalAlignment="Center" Margin="0,0,5,0" />
                            <TextBlock Text="重置" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 操作按钮区域 -->
        <Border Grid.Row="1" Background="White" BorderBrush="#e0e0e0" BorderThickness="1"
                CornerRadius="5" Padding="15" Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal">
                <Button Command="{Binding AddCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#4CAF50"
                        Foreground="White"
                        Padding="15,8"
                        Margin="0,0,10,0">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Plus" Width="16" Height="16"
                                                 VerticalAlignment="Center" Margin="0,0,5,0" />
                        <TextBlock Text="新增" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding EditCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#FF9800"
                        Foreground="White"
                        Padding="15,8"
                        Margin="0,0,10,0">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Pencil" Width="16" Height="16"
                                                 VerticalAlignment="Center" Margin="0,0,5,0" />
                        <TextBlock Text="编辑" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding DeleteCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#F44336"
                        Foreground="White"
                        Padding="15,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Delete" Width="16" Height="16"
                                                 VerticalAlignment="Center" Margin="0,0,5,0" />
                        <TextBlock Text="删除" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <!-- 数据展示区域 -->
        <Border Grid.Row="2" Background="White" BorderBrush="#e0e0e0" BorderThickness="1"
                CornerRadius="5" Margin="0,0,0,15">
            <DataGrid x:Name="BooksDataGrid"
                      ItemsSource="{Binding Books}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="True"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      SelectionMode="Extended"
                      SelectionUnit="FullRow"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      AlternatingRowBackground="#f9f9f9"
                      RowBackground="White"
                      FontSize="18"
                      Margin="1">

                <DataGrid.Columns>
                    <!-- 选择列 -->
                    <DataGridCheckBoxColumn Header="选择"
                                            Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                            Width="75"
                                            CanUserResize="False"
                                            CanUserSort="False" />

                    <!-- ID列 -->
                    <DataGridTextColumn Header="ID"
                                        Binding="{Binding Id}"
                                        Width="100"
                                        IsReadOnly="True" />

                    <!-- 标题列 -->
                    <DataGridTextColumn Header="标题"
                                        Binding="{Binding Title}"
                                        Width="250"
                                        IsReadOnly="True" />

                    <!-- 作者列 -->
                    <DataGridTextColumn Header="作者"
                                        Binding="{Binding Author}"
                                        Width="175"
                                        IsReadOnly="True" />

                    <!-- ISBN列 -->
                    <DataGridTextColumn Header="ISBN"
                                        Binding="{Binding Isbn}"
                                        Width="175"
                                        IsReadOnly="True" />

                    <!-- 出版社列 -->
                    <DataGridTextColumn Header="出版社"
                                        Binding="{Binding Publisher}"
                                        Width="175"
                                        IsReadOnly="True" />

                    <!-- 分类列 -->
                    <DataGridTextColumn Header="分类"
                                        Binding="{Binding Category}"
                                        Width="200"
                                        IsReadOnly="True" />

                    <!-- 总的库存列 -->
                    <DataGridTextColumn Header="库存"
                                        Binding="{Binding Stock}"
                                        Width="100"
                                        IsReadOnly="True" />
                    <!-- 可用库存列 -->
                    <DataGridTextColumn Header="可用"
                                        Binding="{Binding Available}"
                                        Width="100"
                                        IsReadOnly="True" />

                    <!-- 出版日期列 -->
                    <DataGridTextColumn Header="出版日期"
                                        Binding="{Binding PublishDate, StringFormat=yyyy-MM-dd}"
                                        Width="175"
                                        IsReadOnly="True" />
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- 分页区域 -->
        <Border Grid.Row="3" Background="White" BorderBrush="#e0e0e0" BorderThickness="1"
                CornerRadius="5" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 分页信息 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="共" Margin="0,0,5,0" />
                    <TextBlock Text="{Binding TotalCount}" FontWeight="Bold" Foreground="#2196F3" />
                    <TextBlock Text="条记录，第" Margin="5,0" />
                    <TextBlock Text="{Binding CurrentPage}" FontWeight="Bold" Foreground="#2196F3" />
                    <TextBlock Text="/" Margin="2,0" />
                    <TextBlock Text="{Binding TotalPages}" FontWeight="Bold" Foreground="#2196F3" />
                    <TextBlock Text="页" Margin="2,0,0,0" />
                </StackPanel>

                <!-- 分页控件 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- 首页 -->
                    <Button Command="{Binding FirstPageCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Padding="8"
                            Margin="0,0,5,0"
                            ToolTip="首页">
                        <materialDesign:PackIcon Kind="PageFirst" Width="16" Height="16" />
                    </Button>

                    <!-- 上一页 -->
                    <Button Command="{Binding PreviousPageCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Padding="8"
                            Margin="0,0,5,0"
                            ToolTip="上一页">
                        <materialDesign:PackIcon Kind="ChevronLeft" Width="16" Height="16" />
                    </Button>

                    <!-- 页码输入 -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
                        <TextBlock Text="跳转到" VerticalAlignment="Center" Margin="0,0,5,0" />
                        <TextBox Text="{Binding JumpToPage, UpdateSourceTrigger=PropertyChanged}"
                                 Width="50"
                                 TextAlignment="Center"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}" />
                        <TextBlock Text="页" VerticalAlignment="Center" Margin="5,0,10,0" />
                        <Button Command="{Binding JumpToPageCommand}"
                                Content="跳转"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Padding="10,5" />
                    </StackPanel>

                    <!-- 下一页 -->
                    <Button Command="{Binding NextPageCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Padding="8"
                            Margin="5,0"
                            ToolTip="下一页">
                        <materialDesign:PackIcon Kind="ChevronRight" Width="16" Height="16" />
                    </Button>

                    <!-- 末页 -->
                    <Button Command="{Binding LastPageCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Padding="8"
                            Margin="5,0,0,0"
                            ToolTip="末页">
                        <materialDesign:PackIcon Kind="PageLast" Width="16" Height="16" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>